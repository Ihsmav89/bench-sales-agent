{% extends "base.html" %}
{% block title %}Search Roles — Bench Sales Agent{% endblock %}
{% block content %}
<h2 class="text-2xl font-bold mb-6">Search for Contract Roles</h2>

<div class="bg-dark-800 rounded-lg p-5 border border-dark-600 mb-6">
    <form hx-post="/search/xray" hx-target="#search-results" hx-indicator="#search-spinner">
        <!-- Mode toggle -->
        <div class="flex gap-4 mb-4">
            <label class="flex items-center gap-2 cursor-pointer">
                <input type="radio" name="mode" value="custom" checked onchange="document.getElementById('custom-fields').style.display='block'; document.getElementById('consultant-field').style.display='none';" class="text-accent">
                <span class="text-sm">Custom Search</span>
            </label>
            {% if consultants %}
            <label class="flex items-center gap-2 cursor-pointer">
                <input type="radio" name="mode" value="consultant" onchange="document.getElementById('custom-fields').style.display='none'; document.getElementById('consultant-field').style.display='block';" class="text-accent">
                <span class="text-sm">By Consultant</span>
            </label>
            {% endif %}
        </div>

        <!-- Custom search fields -->
        <div id="custom-fields" class="grid grid-cols-3 gap-4 mb-4">
            <div>
                <label class="block text-sm text-gray-400 mb-1">Job Title *</label>
                <input type="text" name="job_title" placeholder="e.g., Java Developer" class="w-full px-3 py-2 bg-dark-900 border border-dark-600 rounded text-gray-200 focus:border-accent focus:outline-none">
            </div>
            <div>
                <label class="block text-sm text-gray-400 mb-1">Skills (comma-separated) *</label>
                <input type="text" name="skills" placeholder="Java, Spring Boot, AWS" class="w-full px-3 py-2 bg-dark-900 border border-dark-600 rounded text-gray-200 focus:border-accent focus:outline-none">
            </div>
            <div>
                <label class="block text-sm text-gray-400 mb-1">Location</label>
                <input type="text" name="location" placeholder="City, ST (optional)" class="w-full px-3 py-2 bg-dark-900 border border-dark-600 rounded text-gray-200 focus:border-accent focus:outline-none">
            </div>
        </div>

        <!-- Consultant selector -->
        <div id="consultant-field" class="mb-4" style="display:none;">
            <label class="block text-sm text-gray-400 mb-1">Select Consultant</label>
            <select name="consultant_id" class="w-full px-3 py-2 bg-dark-900 border border-dark-600 rounded text-gray-200 focus:border-accent focus:outline-none">
                <option value="">— Choose —</option>
                {% for c in consultants %}
                <option value="{{ c.id }}">{{ c.full_name }} — {{ c.job_title }} ({{ c.primary_skills[:3] | join(', ') }})</option>
                {% endfor %}
            </select>
        </div>

        <button type="submit" class="px-6 py-2 bg-accent text-dark-900 rounded font-semibold hover:bg-accent-light">
            Generate X-Ray Queries
        </button>
        <span id="search-spinner" class="htmx-indicator text-sm text-gray-400 ml-3">
            <svg class="inline spinner w-4 h-4 mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10" stroke-dasharray="60" stroke-dashoffset="20"/></svg>
            Generating queries...
        </span>
    </form>
</div>

<div id="search-results"></div>
{% endblock %}
